<nav class="navbar navbar-expand-lg admin-header mb-4">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold" href="/">Household</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="mainNavbar">
            <div class="navbar-nav ms-auto align-items-center">
                <%
                    # --- Build Navigation ---
                    current_path = request.path_info
                    nav_items = []

                    # 1. Common Links
                    nav_items << { href: "/", icon: 'fa-home', text: 'Home' } unless current_path == '/'
                    nav_items << { href: "/leaderboard", icon: 'fa-trophy', text: 'Leaderboard' } unless current_path == '/leaderboard'

                    # 2. Member-specific links
                    if member_selected?
                        nav_items << { href: "/profile/edit", icon: 'fa-user-edit', text: 'Profile' }
                    end

                    # 3. Append plugin-provided links (already in @nav_links)
                    nav_items.concat(@nav_links || [])

                    # 4. Final fallback link (Admin Login)
                    unless admin_logged_in? || member_selected? || current_path.start_with?('/admin')
                        nav_items << { href: "/admin/login", icon: 'fa-user-shield', text: 'Admin' }
                    end
                %>

                <%# --- Render Navigation --- %>
                <% nav_items.each do |item| %>
                    <% if item[:type] == :button %>
                        <div class="nav-item ms-lg-3">
                           <a class="btn btn-sm btn-secondary" href="<%= item[:href] %>" role="button">
                                <i class="fas <%= item[:icon] %>"></i> <%= item[:text] %>
                            </a>
                        </div>
                    <% elsif item[:type] == :icon %>
                         <div class="nav-item">
                            <a class="nav-link ms-2" href="<%= item[:href] %>" title="<%= item[:title] %>">
                                <i class="fas <%= item[:icon] %>"></i>
                            </a>
                        </div>
                    <% else %>
                        <a class="nav-link" href="<%= item[:href] %>">
                            <i class="fas <%= item[:icon] %>"></i> <%= item[:text] %>
                        </a>
                    <% end %>
                <% end %>
            </div>
        </div>
    </div>
</nav>
